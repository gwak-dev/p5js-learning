<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>p5.js ê²Œì„ ë§Œë“¤ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #3b82f6;
            --success: #22c55e;
            --error: #ef4444;
            --bg: #000;
            --surface: #0a0a0a;
            --card: #111;
            --border: #222;
            --text: #fff;
            --muted: #888;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--surface);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 0.85rem;
        }

        .stat { display: flex; align-items: center; gap: 5px; }
        .stat-icon { font-size: 1rem; }
        .stat-value { font-weight: 600; color: var(--primary); }

        /* Main Layout */
        .main-wrapper {
            margin-right: 360px;
            transition: margin-right 0.3s ease;
        }

        .main-wrapper.sidebar-collapsed {
            margin-right: 0;
        }

        .main {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        @media (max-width: 1200px) {
            .main-wrapper { margin-right: 0; }
            .main { max-width: 100%; }
        }

        /* Home Screen */
        .home { display: block; }
        .home.hidden { display: none; }

        .welcome {
            text-align: center;
            margin-bottom: 40px;
        }

        .welcome h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .welcome p {
            color: var(--muted);
            font-size: 0.95rem;
        }

        /* Game Preview */
        .game-preview {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .game-preview h3 {
            margin-bottom: 15px;
            color: var(--text);
            font-weight: 500;
        }

        .game-preview-canvas {
            border-radius: 8px;
            overflow: hidden;
            display: inline-block;
        }

        .day-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .day-item {
            background: var(--card);
            border-radius: 10px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .day-item:hover {
            background: var(--surface);
            border-color: #333;
        }

        .day-item.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .day-item.locked:hover {
            background: var(--card);
            border-color: var(--border);
        }

        .day-item.completed {
            border-color: var(--success);
        }

        .day-icon {
            width: 44px;
            height: 44px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .day-info { flex: 1; }
        .day-info h3 { margin-bottom: 4px; font-size: 1rem; font-weight: 500; }
        .day-info p { color: var(--muted); font-size: 0.85rem; }

        .day-progress {
            font-size: 0.8rem;
            color: var(--muted);
        }

        /* Lesson Screen */
        .lesson { display: none; }
        .lesson.active { display: block; }

        .lesson-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }

        .back-btn {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: var(--surface);
            border-color: #333;
        }

        .lesson-title { flex: 1; }
        .lesson-title h2 { font-size: 1.1rem; margin-bottom: 2px; font-weight: 500; }
        .lesson-title p { color: var(--muted); font-size: 0.8rem; }

        /* Progress Bar */
        .progress-container { margin-bottom: 25px; }

        .progress-steps {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }

        .progress-step {
            flex: 1;
            height: 3px;
            background: var(--border);
            border-radius: 2px;
            transition: all 0.2s;
        }

        .progress-step.completed { background: var(--success); }
        .progress-step.current { background: var(--primary); }

        .progress-text {
            text-align: center;
            font-size: 0.8rem;
            color: var(--muted);
        }

        /* Content Card */
        .content-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .step-emoji {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 16px;
        }

        .step-title {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .step-content {
            line-height: 1.8;
            color: var(--muted);
        }

        .step-content p { margin-bottom: 12px; }
        .step-content strong { color: var(--text); }

        .highlight-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--primary);
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 16px 0;
        }

        .highlight-box.success {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--success);
        }

        .highlight-box.warning {
            background: rgba(234, 179, 8, 0.1);
            border-color: #eab308;
        }

        /* Code Section */
        .code-preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        @media (max-width: 700px) {
            .code-preview-container {
                grid-template-columns: 1fr;
            }
        }

        .code-section { margin: 0; }

        .code-label {
            font-size: 0.8rem;
            color: var(--muted);
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .code-readonly {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 13px;
            color: #e0e0e0;
            line-height: 1.7;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .code-editor {
            background: var(--surface);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .code-editor.correct { border-color: var(--success); }
        .code-editor.wrong { border-color: var(--error); }

        .code-result {
            background: var(--surface);
            padding: 10px 14px;
            font-family: 'Monaco', monospace;
            font-size: 12px;
            color: var(--muted);
            min-height: 36px;
        }

        .code-result.success { color: var(--success); }
        .code-result.error { color: var(--error); }

        /* Canvas Preview */
        .preview-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-label {
            font-size: 0.8rem;
            color: var(--muted);
            padding: 8px 12px;
            background: var(--card);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-canvas-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background: #0a0a0a;
            min-height: 180px;
        }

        .preview-canvas-wrapper canvas {
            border-radius: 4px;
        }

        /* Target Preview */
        .target-preview {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
        }

        .target-preview h4 {
            color: var(--text);
            margin-bottom: 12px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .target-canvas {
            display: inline-block;
            border-radius: 6px;
            overflow: hidden;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
            min-width: 100px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-check {
            background: var(--success);
            color: white;
        }

        .btn-check:hover {
            background: #16a34a;
        }

        .btn-run {
            background: #333;
            color: white;
            border: 1px solid #444;
        }

        .btn-run:hover {
            background: #444;
        }

        .btn-retry {
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--border);
        }

        .btn-retry:hover {
            border-color: #444;
            color: var(--text);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Quiz */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 16px 0;
        }

        .quiz-option {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 14px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .quiz-option:hover { border-color: #444; background: var(--surface); }
        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
        }
        .quiz-option.wrong {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Reward Modal */
        .reward-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .reward-overlay.active { display: flex; }

        .reward-card {
            background: var(--card);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            border: 2px solid var(--accent);
        }

        .reward-emoji {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .reward-title {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .reward-xp {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--success);
            margin: 20px 0;
        }

        /* Save Section */
        .save-section {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
        }

        .save-section h3 {
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .save-btns {
            display: flex;
            gap: 10px;
        }

        .save-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .save-btn.export { background: var(--success); color: white; }
        .save-btn.import { background: var(--primary); color: white; }

        .save-msg {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
        }

        .save-msg.show {
            display: block;
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        /* CodeMirror Custom */
        .CodeMirror {
            height: auto;
            min-height: 100px;
            max-height: 300px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 14px;
            border-radius: 12px;
        }

        .CodeMirror-scroll {
            min-height: 100px;
            max-height: 300px;
        }

        .cm-wrapper {
            border-radius: 12px;
            overflow: hidden;
        }

        /* Editor hint */
        .editor-hint {
            color: var(--muted);
            font-size: 0.85rem;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        /* Confetti */
        .confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Settings */
        .settings-btn {
            background: transparent;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .settings-btn:hover { opacity: 1; }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: var(--card);
            padding: 30px;
            border-radius: 15px;
            max-width: 450px;
            width: 90%;
        }
        .modal-content h3 {
            margin-bottom: 20px;
        }
        .setting-item {
            margin-bottom: 20px;
        }
        .setting-item label {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }
        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .api-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .modal-btns {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .btn-small {
            padding: 8px 12px;
            font-size: 0.8rem;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
        }

        /* AI Chat - Fixed Right Sidebar */
        .ai-sidebar {
            position: fixed;
            right: 0;
            top: 0;
            width: 360px;
            height: 100vh;
            background: var(--surface);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 200;
            transition: transform 0.3s ease;
        }
        .ai-sidebar.collapsed {
            transform: translateX(100%);
        }
        .ai-sidebar-toggle {
            position: fixed;
            right: 360px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 60px;
            background: var(--card);
            border: 1px solid var(--border);
            border-right: none;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--muted);
            font-size: 0.9rem;
            z-index: 201;
            transition: all 0.3s ease;
        }
        .ai-sidebar.collapsed + .ai-sidebar-toggle,
        .ai-sidebar-toggle.collapsed {
            right: 0;
        }
        .ai-sidebar-toggle:hover {
            background: var(--surface);
            color: var(--text);
        }
        .ai-chat-header {
            background: var(--card);
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .ai-chat-header-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--text);
        }
        .ai-chat-header-title .gemini-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #4285f4, #9b72cb, #d96570);
            border-radius: 50%;
        }
        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg);
        }
        .ai-chat-message {
            margin-bottom: 16px;
            display: flex;
            gap: 10px;
        }
        .ai-chat-message.user {
            flex-direction: row-reverse;
        }
        .ai-chat-message .avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            flex-shrink: 0;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ai-chat-message.user .avatar {
            background: #333;
        }
        .ai-chat-message.ai .avatar {
            background: linear-gradient(135deg, #4285f4, #9b72cb, #d96570);
        }
        .ai-chat-message .bubble {
            padding: 10px 14px;
            border-radius: 12px;
            max-width: 85%;
            line-height: 1.6;
            font-size: 0.9rem;
        }
        .ai-chat-message.user .bubble {
            background: var(--card);
            color: var(--text);
            border-radius: 12px 12px 4px 12px;
        }
        .ai-chat-message.ai .bubble {
            background: var(--surface);
            color: #ccc;
            border-radius: 12px 12px 12px 4px;
            border: 1px solid var(--border);
        }
        .ai-chat-input-area {
            padding: 12px;
            background: var(--card);
            border-top: 1px solid var(--border);
        }
        .ai-chat-input-wrapper {
            display: flex;
            align-items: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 4px 4px 4px 14px;
        }
        .ai-chat-input {
            flex: 1;
            padding: 10px 0;
            border: none;
            background: transparent;
            color: var(--text);
            font-size: 0.9rem;
        }
        .ai-chat-input:focus {
            outline: none;
        }
        .ai-chat-input::placeholder {
            color: #666;
        }
        .ai-chat-send {
            background: var(--primary);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .ai-chat-send:hover {
            background: #2563eb;
        }
        .ai-chat-send:disabled {
            background: #333;
            cursor: not-allowed;
        }
        .ai-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--muted);
            padding: 8px 0;
            font-size: 0.85rem;
        }
        .ai-loading::before {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid var(--primary);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @media (max-width: 1200px) {
            .ai-sidebar {
                transform: translateX(100%);
            }
            .ai-sidebar.open {
                transform: translateX(0);
            }
            .ai-sidebar-toggle {
                right: 0;
            }
            .ai-sidebar.open + .ai-sidebar-toggle {
                right: 360px;
            }
        }

        /* Hide old AI hint button */
        .ai-hint-btn { display: none; }
        #ai-hint-container { display: none; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">ğŸ® ê²Œì„ ë§Œë“¤ê¸°</div>
        <div class="stats">
            <div class="stat">
                <span class="stat-icon">âš¡</span>
                <span class="stat-value" id="xp-display">0</span>
                <span>XP</span>
            </div>
            <div class="stat">
                <span class="stat-icon">ğŸ”¥</span>
                <span class="stat-value" id="streak-display">0</span>
                <span>ì¼</span>
            </div>
            <button class="settings-btn" onclick="openSettings()" title="ì„¤ì •">âš™ï¸</button>
        </div>
    </header>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal" style="display:none;">
        <div class="modal-content">
            <h3>âš™ï¸ ì„¤ì •</h3>
            <div class="setting-item">
                <label>Gemini API í‚¤ (ë¬´ë£Œ)</label>
                <p style="font-size:0.8rem;color:var(--muted);margin:5px 0;">AI íŒíŠ¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ê°€ í•„ìš”í•´ìš”.<br>í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ê³  ì™¸ë¶€ì— ê³µê°œë˜ì§€ ì•Šì•„ìš”.<br><a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--primary);">ğŸ‘‰ ë¬´ë£Œ API í‚¤ ë°›ê¸°</a></p>
                <input type="password" id="api-key-input" placeholder="AIzaSy..." class="api-input">
                <button class="btn btn-small" onclick="toggleApiKeyVisibility()">ğŸ‘ï¸ ë³´ê¸°</button>
            </div>
            <div class="modal-btns">
                <button class="btn btn-secondary" onclick="closeSettings()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveSettings()">ì €ì¥</button>
            </div>
        </div>
    </div>


    <div class="main-wrapper" id="main-wrapper">
    <main class="main">
        <!-- Home Screen -->
        <div class="home" id="home-screen">
            <div class="welcome">
                <h1>ğŸ® ë‚˜ë§Œì˜ ê²Œì„ ë§Œë“¤ê¸°</h1>
                <p>7ì¼ ë™ì•ˆ ì‹¤ì œ ê²Œì„ì„ ì§ì ‘ ë§Œë“¤ì–´ë´ìš”!</p>
            </div>

            <div class="game-preview">
                <h3>ğŸ¯ ìš°ë¦¬ê°€ ë§Œë“¤ ê²Œì„</h3>
                <div class="game-preview-canvas" id="final-game-preview"></div>
                <p style="color: var(--muted); margin-top: 15px; font-size: 0.9rem;">
                    íš¡ìŠ¤í¬ë¡¤ í”Œë«í¼ ê²Œì„ - ìºë¦­í„°ê°€ ë›°ê³ , ì•„ì´í…œì„ ëª¨ìœ¼ê³ , í˜‘ê³¡ì„ í”¼í•´ìš”!
                </p>
            </div>

            <div class="day-list" id="day-list"></div>

            <div class="save-section">
                <h3>ğŸ’¾ ì§„í–‰ìƒí™© ì €ì¥</h3>
                <div class="save-btns">
                    <button class="save-btn export" onclick="exportProgress()">ğŸ“¤ ë°±ì—…</button>
                    <button class="save-btn import" onclick="document.getElementById('import-file').click()">ğŸ“¥ ë³µì›</button>
                    <input type="file" id="import-file" accept=".json" style="display:none" onchange="importProgress(event)">
                </div>
                <div class="save-msg" id="save-msg"></div>
            </div>
        </div>

        <!-- Lesson Screen -->
        <div class="lesson" id="lesson-screen">
            <div class="lesson-header">
                <button class="back-btn" onclick="goHome()">â†</button>
                <div class="lesson-title">
                    <h2 id="lesson-title-text">Day 1</h2>
                    <p id="lesson-subtitle-text">ìº”ë²„ìŠ¤ ë§Œë“¤ê¸°</p>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-steps" id="progress-steps"></div>
                <div class="progress-text" id="progress-text">1 / 5</div>
            </div>

            <div class="content-card" id="step-content"></div>

            <div class="btn-group" id="btn-group">
                <button class="btn btn-primary" id="next-btn" onclick="nextStep()">ë‹¤ìŒ â†’</button>
            </div>
        </div>
    </main>
    </div>

    <!-- Fixed AI Sidebar -->
    <div class="ai-sidebar" id="ai-sidebar">
        <div class="ai-chat-header">
            <div class="ai-chat-header-title">
                <div class="gemini-icon"></div>
                <span>AI íŠœí„°</span>
            </div>
        </div>
        <div class="ai-chat-messages" id="ai-chat-messages">
            <div class="ai-chat-message ai">
                <div class="avatar"></div>
                <div class="bubble">ì•ˆë…•í•˜ì„¸ìš”! ì½”ë“œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”. ğŸ¤—</div>
            </div>
        </div>
        <div class="ai-chat-input-area">
            <div class="ai-chat-input-wrapper">
                <input type="text" class="ai-chat-input" id="ai-chat-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.key==='Enter')sendAIMessage()">
                <button class="ai-chat-send" onclick="sendAIMessage()">â¤</button>
            </div>
        </div>
    </div>
    <button class="ai-sidebar-toggle" id="ai-sidebar-toggle" onclick="toggleAISidebar()">â—€</button>

    <!-- Reward Modal -->
    <div class="reward-overlay" id="reward-overlay">
        <div class="reward-card">
            <div class="reward-emoji" id="reward-emoji">ğŸ‰</div>
            <h2 class="reward-title">ëŒ€ë‹¨í•´ìš”!</h2>
            <p id="reward-text">Dayë¥¼ ì™„ë£Œí–ˆì–´ìš”!</p>
            <div class="reward-xp" id="reward-xp">+50 XP</div>
            <button class="btn btn-primary" onclick="closeReward()" style="width:100%; margin-top:20px;">ê³„ì†í•˜ê¸°</button>
        </div>
    </div>

    <canvas class="confetti-canvas" id="confetti"></canvas>

    <script>
    // ==========================================
    // SOUND EFFECTS
    // ==========================================
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        if (type === 'correct') {
            // Happy sound - ascending notes
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialDecayTo = 0.01;
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.4);
        } else if (type === 'wrong') {
            // Sad sound - low buzz
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.type = 'sawtooth';
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        } else if (type === 'click') {
            // Click sound
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.05);
        } else if (type === 'success') {
            // Fanfare
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.15);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.3);
            oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.45);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.6);
        }
    }

    // ==========================================
    // LESSON DATA - Project Based
    // ==========================================
    const LESSONS = [
        {
            day: 1,
            title: "ìº”ë²„ìŠ¤ & ë°°ê²½",
            subtitle: "ê²Œì„ í™”ë©´ ë§Œë“¤ê¸°",
            icon: "ğŸ–¼ï¸",
            xp: 50,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="target-preview">
                            <h4>ğŸ–¼ï¸ ê²Œì„ ë°°ê²½</h4>
                            <div class="target-canvas" id="day1-target"></div>
                        </div>
                        <p><strong>íŒŒë€ í•˜ëŠ˜</strong>ê³¼ <strong>ì´ˆë¡ ë•…</strong>ì„ ê·¸ë ¤ë³¼ ê±°ì˜ˆìš”!</p>
                    `,
                    targetDraw: (p) => {
                        p.background(100, 155, 255);
                        p.noStroke();
                        p.fill(0, 155, 0);
                        p.rect(0, p.height * 3/4, p.width, p.height/4);
                    }
                },
                {
                    type: "explain",
                    emoji: "ğŸ“",
                    title: "createCanvas() - ìº”ë²„ìŠ¤ ë§Œë“¤ê¸°",
                    content: `
                        <p><strong>createCanvas(ê°€ë¡œ, ì„¸ë¡œ)</strong>ë¡œ ê·¸ë¦¼ ê·¸ë¦´ ê³µê°„ì„ ë§Œë“¤ì–´ìš”.</p>
                        <div class="highlight-box">
                            <strong>ğŸ’¡ ì¢Œí‘œ ì‹œìŠ¤í…œ</strong><br>
                            â€¢ (0, 0)ì€ <strong>ì™¼ìª½ ìœ„</strong> ëª¨ì„œë¦¬<br>
                            â€¢ Xê°€ ì»¤ì§€ë©´ â†’ ì˜¤ë¥¸ìª½ìœ¼ë¡œ<br>
                            â€¢ Yê°€ ì»¤ì§€ë©´ â†’ ì•„ë˜ë¡œ
                        </div>
                    `,
                    code: `function setup() {
    createCanvas(400, 300);
    // ê°€ë¡œ 400í”½ì…€, ì„¸ë¡œ 300í”½ì…€
}`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ 1: ìº”ë²„ìŠ¤ ë§Œë“¤ê¸°",
                    content: `<p>ê°€ë¡œ <strong>500</strong>, ì„¸ë¡œ <strong>400</strong> í¬ê¸°ì˜ ìº”ë²„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>`,
                    starterCode: `function setup() {
    // ì—¬ê¸°ì— createCanvas ì“°ê¸°

}`,
                    answer: "createCanvas(500, 400)",
                    answerCheck: (code) => {
                        return code.includes('createCanvas') &&
                               code.includes('500') &&
                               code.includes('400');
                    },
                    hint: "createCanvas(ê°€ë¡œ, ì„¸ë¡œ) í˜•íƒœë¡œ ì¨ìš”"
                },
                {
                    type: "explain",
                    emoji: "ğŸ¨",
                    title: "background() - ë°°ê²½ìƒ‰ ì¹ í•˜ê¸°",
                    content: `
                        <p><strong>background(ë¹¨ê°•, ì´ˆë¡, íŒŒë‘)</strong>ìœ¼ë¡œ ì „ì²´ ë°°ê²½ì„ ì¹ í•´ìš”.</p>
                        <p>ê° ìƒ‰ìƒ ê°’ì€ <strong>0~255</strong> ì‚¬ì´ì˜ˆìš”.</p>
                    `,
                    code: `function draw() {
    background(100, 155, 255);
    // ë¹¨ê°• 100, ì´ˆë¡ 155, íŒŒë‘ 255
    // = í•˜ëŠ˜ìƒ‰!
}`
                },
                {
                    type: "interactive",
                    emoji: "ğŸ–Œï¸",
                    title: "ìƒ‰ìƒ ì‹¤í—˜í•˜ê¸°",
                    content: `<p>ìˆ«ìë¥¼ ë°”ê¿”ì„œ ë‹¤ë¥¸ ìƒ‰ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>`,
                    defaultCode: `// ìˆ«ìë¥¼ ë°”ê¿”ë³´ì„¸ìš” (0-255)
background(100, 155, 255);

// ë¹¨ê°„ìƒ‰: background(255, 0, 0);
// ì´ˆë¡ìƒ‰: background(0, 255, 0);
// íŒŒë€ìƒ‰: background(0, 0, 255);`,
                    canvasSize: { w: 200, h: 150 }
                },
                {
                    type: "explain",
                    emoji: "ğŸ“¦",
                    title: "rect() - ì‚¬ê°í˜• ê·¸ë¦¬ê¸°",
                    content: `
                        <p><strong>rect(x, y, ê°€ë¡œ, ì„¸ë¡œ)</strong>ë¡œ ì‚¬ê°í˜•ì„ ê·¸ë ¤ìš”.</p>
                        <p><strong>fill(ë¹¨ê°•, ì´ˆë¡, íŒŒë‘)</strong>ìœ¼ë¡œ ìƒ‰ì„ ì •í•´ìš”.</p>
                    `,
                    code: `// ìƒ‰ ì •í•˜ê¸°
fill(0, 155, 0);  // ì´ˆë¡ìƒ‰

// ì‚¬ê°í˜• ê·¸ë¦¬ê¸°
rect(0, 225, 400, 75);
// x=0, y=225 ìœ„ì¹˜ì—
// ê°€ë¡œ 400, ì„¸ë¡œ 75 ì‚¬ê°í˜•`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ 2: ì´ˆë¡ ë•… ê·¸ë¦¬ê¸°",
                    content: `<p>x=0, y=200 ìœ„ì¹˜ì— ê°€ë¡œ 300, ì„¸ë¡œ 100ì¸ <strong>ì´ˆë¡ìƒ‰ ì‚¬ê°í˜•</strong>ì„ ê·¸ë ¤ë³´ì„¸ìš”.</p>`,
                    starterCode: `function draw() {
    background(100, 155, 255);

    // ì´ˆë¡ìƒ‰ìœ¼ë¡œ ì„¤ì •
    fill(0, 155, 0);

    // ì—¬ê¸°ì— rect ì“°ê¸°

}`,
                    answer: "rect(0, 200, 300, 100)",
                    answerCheck: (code) => {
                        return code.includes('rect') &&
                               code.includes('0') &&
                               code.includes('200') &&
                               code.includes('300') &&
                               code.includes('100');
                    },
                    hint: "rect(x, y, ê°€ë¡œ, ì„¸ë¡œ) í˜•íƒœë¡œ ì¨ìš”"
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ê²Œì„ ë°°ê²½",
                    content: `<p>í•˜ëŠ˜ê³¼ ë•…ì´ ìˆëŠ” ê²Œì„ ë°°ê²½ì„ ì™„ì„±í•´ë³´ì„¸ìš”!</p>`,
                    starterCode: `function setup() {
    createCanvas(400, 300);
}

function draw() {
    // 1. í•˜ëŠ˜ìƒ‰ ë°°ê²½
    background(100, 155, 255);

    // 2. í…Œë‘ë¦¬ ì—†ì• ê¸°
    noStroke();

    // 3. ì´ˆë¡ìƒ‰ ì„¤ì •
    fill(0, 155, 0);

    // 4. ë•… ê·¸ë¦¬ê¸° (ì•„ë˜ìª½ 1/4)
    // rect(x, y, ê°€ë¡œ, ì„¸ë¡œ)

}`,
                    targetCode: `rect(0, 225, 400, 75)`,
                    answerCheck: (code) => {
                        return code.includes('rect') &&
                               code.includes('225') || code.includes('height');
                    },
                    hint: "ìº”ë²„ìŠ¤ ë†’ì´ê°€ 300ì´ë‹ˆê¹Œ, 3/4 ìœ„ì¹˜ì¸ 225ë¶€í„° ë•…ì„ ê·¸ë ¤ìš”",
                    canvasSize: { w: 400, h: 300 }
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "í™•ì¸ í€´ì¦ˆ",
                    question: "p5.jsì—ì„œ (0, 0) ì¢Œí‘œëŠ” ì–´ë””ì¼ê¹Œìš”?",
                    options: [
                        "í™”ë©´ ì¤‘ì•™",
                        "ì™¼ìª½ ìœ„ ëª¨ì„œë¦¬",
                        "ì™¼ìª½ ì•„ë˜ ëª¨ì„œë¦¬",
                        "ì˜¤ë¥¸ìª½ ìœ„ ëª¨ì„œë¦¬"
                    ],
                    correct: 1,
                    explanation: "p5.jsì—ì„œ (0,0)ì€ ì™¼ìª½ ìœ„ ëª¨ì„œë¦¬ì˜ˆìš”. Xê°€ ì»¤ì§€ë©´ ì˜¤ë¥¸ìª½, Yê°€ ì»¤ì§€ë©´ ì•„ë˜ë¡œ ì´ë™í•´ìš”."
                }
            ]
        },
        {
            day: 2,
            title: "ìºë¦­í„° ê·¸ë¦¬ê¸°",
            subtitle: "ê²Œì„ ì£¼ì¸ê³µ ë§Œë“¤ê¸°",
            icon: "ğŸ§‘",
            xp: 60,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="target-preview">
                            <h4>ğŸ§‘ ê²Œì„ ìºë¦­í„°</h4>
                            <div class="target-canvas" id="day2-target"></div>
                        </div>
                        <p>ë¨¸ë¦¬, ëª¸í†µ, íŒ”, ë‹¤ë¦¬ê°€ ìˆëŠ” ìºë¦­í„°ë¥¼ ê·¸ë ¤ë³¼ ê±°ì˜ˆìš”!</p>
                    `,
                    targetDraw: (p) => {
                        p.background(100, 155, 255);
                        p.noStroke();
                        p.fill(0, 155, 0);
                        p.rect(0, p.height * 3/4, p.width, p.height/4);

                        let x = p.width/2;
                        let y = p.height * 3/4;
                        // Head
                        p.fill(200, 150, 150);
                        p.ellipse(x, y - 47, 25);
                        // Body
                        p.fill(255, 0, 0);
                        p.rect(x - 13, y - 35, 26, 30);
                        // Arms
                        p.fill(0);
                        p.rect(x - 18, y - 35, 6, 20);
                        p.rect(x + 12, y - 35, 6, 20);
                        // Feet
                        p.rect(x - 15, y - 6, 10, 10);
                        p.rect(x + 5, y - 6, 10, 10);
                    }
                },
                {
                    type: "explain",
                    emoji: "ğŸ“¦",
                    title: "ë³€ìˆ˜ë¡œ ìœ„ì¹˜ ì €ì¥í•˜ê¸°",
                    content: `
                        <p>ìºë¦­í„° ìœ„ì¹˜ë¥¼ <strong>ë³€ìˆ˜</strong>ì— ì €ì¥í•˜ë©´ ë‚˜ì¤‘ì— ì‰½ê²Œ ì›€ì§ì¼ ìˆ˜ ìˆì–´ìš”!</p>
                    `,
                    code: `var gameChar_x;  // X ìœ„ì¹˜
var gameChar_y;  // Y ìœ„ì¹˜

function setup() {
    createCanvas(400, 300);
    gameChar_x = 200;  // ì¤‘ì•™
    gameChar_y = 225;  // ë•… ìœ„ì¹˜
}`
                },
                {
                    type: "explain",
                    emoji: "â­•",
                    title: "ellipse() - ì› ê·¸ë¦¬ê¸°",
                    content: `
                        <p><strong>ellipse(x, y, ê°€ë¡œ, ì„¸ë¡œ)</strong>ë¡œ ì›ì´ë‚˜ íƒ€ì›ì„ ê·¸ë ¤ìš”.</p>
                        <p>ê°€ë¡œ=ì„¸ë¡œë©´ <strong>ì›</strong>ì´ ë¼ìš”!</p>
                    `,
                    code: `// ë¨¸ë¦¬ (ì›)
fill(200, 150, 150);  // ì‚´ìƒ‰
ellipse(gameChar_x, gameChar_y - 47, 25);
// ìºë¦­í„° ìœ„ì¹˜ì—ì„œ 47í”½ì…€ ìœ„ì—
// ì§€ë¦„ 25ì¸ ì›`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ 1: ë¨¸ë¦¬ ê·¸ë¦¬ê¸°",
                    content: `<p>x=100, y=100 ìœ„ì¹˜ì— ì§€ë¦„ 30ì¸ ì›ì„ ê·¸ë ¤ë³´ì„¸ìš”.</p>`,
                    starterCode: `function setup() {
    createCanvas(200, 200);
}

function draw() {
    background(100, 155, 255);
    fill(200, 150, 150);

    // ì› ê·¸ë¦¬ê¸°

}`,
                    answer: "ellipse(100, 100, 30)",
                    answerCheck: (code) => {
                        return code.includes('ellipse') &&
                               code.includes('100') &&
                               code.includes('30');
                    },
                    hint: "ellipse(x, y, ì§€ë¦„) - ê°€ë¡œì„¸ë¡œ ê°™ìœ¼ë©´ ì›!"
                },
                {
                    type: "explain",
                    emoji: "ğŸ“¦",
                    title: "ìºë¦­í„° ì¡°ë¦½í•˜ê¸°",
                    content: `
                        <p>ìºë¦­í„°ëŠ” ì—¬ëŸ¬ ë„í˜•ì„ <strong>ì¡°ë¦½</strong>í•´ì„œ ë§Œë“¤ì–´ìš”:</p>
                        <div class="highlight-box">
                            1. <strong>ë¨¸ë¦¬</strong> - ellipse (ì›)<br>
                            2. <strong>ëª¸í†µ</strong> - rect (ì‚¬ê°í˜•)<br>
                            3. <strong>íŒ”</strong> - rect 2ê°œ<br>
                            4. <strong>ë‹¤ë¦¬</strong> - rect 2ê°œ
                        </div>
                    `,
                    code: `// ëª¸í†µ (ë¹¨ê°„ìƒ‰)
fill(255, 0, 0);
rect(gameChar_x - 13, gameChar_y - 35, 26, 30);

// íŒ” (ê²€ì •ìƒ‰)
fill(0);
rect(gameChar_x - 18, gameChar_y - 35, 6, 20);
rect(gameChar_x + 12, gameChar_y - 35, 6, 20);

// ë‹¤ë¦¬
rect(gameChar_x - 15, gameChar_y - 6, 10, 10);
rect(gameChar_x + 5, gameChar_y - 6, 10, 10);`
                },
                {
                    type: "interactive",
                    emoji: "ğŸ–Œï¸",
                    title: "ìºë¦­í„° ìƒ‰ìƒ ë°”ê¾¸ê¸°",
                    content: `<p>fill() ê°’ì„ ë°”ê¿”ì„œ ìºë¦­í„° ìƒ‰ìƒì„ ë°”ê¿”ë³´ì„¸ìš”!</p>`,
                    defaultCode: `var x = 100;
var y = 140;

background(100, 155, 255);
noStroke();

// ë•…
fill(0, 155, 0);
rect(0, 150, 200, 50);

// ë¨¸ë¦¬ - ìƒ‰ ë°”ê¿”ë³´ê¸°!
fill(200, 150, 150);
ellipse(x, y - 47, 25);

// ëª¸í†µ - ìƒ‰ ë°”ê¿”ë³´ê¸°!
fill(255, 0, 0);
rect(x - 13, y - 35, 26, 30);

// íŒ”
fill(0);
rect(x - 18, y - 35, 6, 20);
rect(x + 12, y - 35, 6, 20);

// ë‹¤ë¦¬
rect(x - 15, y - 6, 10, 10);
rect(x + 5, y - 6, 10, 10);`,
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ìºë¦­í„°",
                    content: `<p>ë¹ ì§„ ë¶€ë¶„ì„ ì±„ì›Œì„œ ìºë¦­í„°ë¥¼ ì™„ì„±í•˜ì„¸ìš”!</p>`,
                    starterCode: `var gameChar_x = 100;
var gameChar_y = 150;

function setup() {
    createCanvas(200, 200);
}

function draw() {
    background(100, 155, 255);
    noStroke();

    // ë•…
    fill(0, 155, 0);
    rect(0, 150, 200, 50);

    // ë¨¸ë¦¬ (ì‚´ìƒ‰ ì›)
    fill(200, 150, 150);
    ellipse(gameChar_x, gameChar_y - 47, 25);

    // ëª¸í†µ (ë¹¨ê°„ ì‚¬ê°í˜•)
    fill(255, 0, 0);
    // ì—¬ê¸°ì— rect ì¶”ê°€!


    // íŒ” (ê²€ì •)
    fill(0);
    rect(gameChar_x - 18, gameChar_y - 35, 6, 20);
    rect(gameChar_x + 12, gameChar_y - 35, 6, 20);

    // ë‹¤ë¦¬ (ê²€ì •)
    rect(gameChar_x - 15, gameChar_y - 6, 10, 10);
    rect(gameChar_x + 5, gameChar_y - 6, 10, 10);
}`,
                    targetCode: `rect(gameChar_x - 13, gameChar_y - 35, 26, 30)`,
                    answerCheck: (code) => {
                        return code.includes('rect') &&
                               code.includes('gameChar_x') &&
                               code.includes('26') &&
                               code.includes('30');
                    },
                    hint: "ëª¸í†µì€ ìºë¦­í„° ì¤‘ì‹¬ì—ì„œ ì™¼ìª½ìœ¼ë¡œ 13, ìœ„ë¡œ 35 ì´ë™í•œ ìœ„ì¹˜ì— ê·¸ë ¤ìš”",
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "í™•ì¸ í€´ì¦ˆ",
                    question: "ellipse(100, 50, 30, 30)ì€ ë¬´ì—‡ì„ ê·¸ë¦´ê¹Œìš”?",
                    options: [
                        "ê°€ë¡œ 100, ì„¸ë¡œ 50ì¸ íƒ€ì›",
                        "x=100, y=50ì— ì§€ë¦„ 30ì¸ ì›",
                        "30ê°œì˜ ì›",
                        "x=30, y=30ì— ì›"
                    ],
                    correct: 1,
                    explanation: "ellipse(x, y, ê°€ë¡œ, ì„¸ë¡œ)ì—ì„œ ê°€ë¡œ=ì„¸ë¡œë©´ ì›ì´ì—ìš”. ìœ„ì¹˜ëŠ” (100, 50)ì´ê³  ì§€ë¦„ì€ 30ì´ì—ìš”."
                }
            ]
        },
        {
            day: 3,
            title: "í‚¤ë³´ë“œ ì…ë ¥",
            subtitle: "ìºë¦­í„° ì›€ì§ì´ê¸°",
            icon: "âŒ¨ï¸",
            xp: 70,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="highlight-box success">
                            âŒ¨ï¸ í‚¤ë³´ë“œë¡œ ìºë¦­í„° ì›€ì§ì´ê¸°!<br><br>
                            â† ì™¼ìª½ í™”ì‚´í‘œ: ì™¼ìª½ìœ¼ë¡œ ì´ë™<br>
                            â†’ ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ: ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                        </div>
                        <p>í‚¤ë³´ë“œ ì…ë ¥ì„ ë°›ì•„ì„œ ìºë¦­í„°ë¥¼ ì›€ì§ì—¬ë³¼ ê±°ì˜ˆìš”!</p>
                    `
                },
                {
                    type: "explain",
                    emoji: "âœ…",
                    title: "Boolean - ì°¸/ê±°ì§“",
                    content: `
                        <p><strong>Boolean</strong>ì€ ë”± ë‘ ê°€ì§€ë§Œ ê°€ëŠ¥í•´ìš”:</p>
                        <p style="font-size: 1.3rem; text-align: center; margin: 15px 0;">
                            <span style="color: #10b981;">true (ì°¸)</span> ë˜ëŠ”
                            <span style="color: #ef4444;">false (ê±°ì§“)</span>
                        </p>
                        <p>ì „ë“± ìŠ¤ìœ„ì¹˜ì²˜ëŸ¼ ì¼œì§/êº¼ì§ë§Œ ìˆì–´ìš”!</p>
                    `,
                    code: `var isLeft = false;   // ì™¼ìª½ ì´ë™ì¤‘?
var isRight = false;  // ì˜¤ë¥¸ìª½ ì´ë™ì¤‘?

// í‚¤ ëˆ„ë¥´ë©´ true
// í‚¤ ë–¼ë©´ false`
                },
                {
                    type: "explain",
                    emoji: "âŒ¨ï¸",
                    title: "keyPressed() - í‚¤ ëˆ„ë¥¼ ë•Œ",
                    content: `
                        <p><strong>keyPressed()</strong> í•¨ìˆ˜ëŠ” í‚¤ë³´ë“œë¥¼ ëˆ„ë¥¼ ë•Œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë¼ìš”!</p>
                        <p><strong>keyCode</strong>ë¡œ ì–´ë–¤ í‚¤ì¸ì§€ í™•ì¸í•´ìš”.</p>
                    `,
                    code: `function keyPressed() {
    if (keyCode == 37) {  // ì™¼ìª½ í™”ì‚´í‘œ
        isLeft = true;
    }
    if (keyCode == 39) {  // ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ
        isRight = true;
    }
}

// í‚¤ ì½”ë“œ:
// 37 = ì™¼ìª½, 39 = ì˜¤ë¥¸ìª½
// 38 = ìœ„, 40 = ì•„ë˜
// 32 = ìŠ¤í˜ì´ìŠ¤ë°”`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ: ì¡°ê±´ë¬¸ ì‘ì„±í•˜ê¸°",
                    content: `<p>keyCodeê°€ 39(ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ)ì¼ ë•Œ isRightë¥¼ trueë¡œ ë°”ê¾¸ëŠ” ì¡°ê±´ë¬¸ì„ ì¨ë³´ì„¸ìš”.</p>`,
                    starterCode: `function keyPressed() {
    // keyCodeê°€ 39ì´ë©´ isRight = true

}`,
                    answer: "if (keyCode == 39)",
                    answerCheck: (code) => {
                        return code.includes('if') &&
                               code.includes('keyCode') &&
                               code.includes('39');
                    },
                    hint: "if (keyCode == 39) { isRight = true; }"
                },
                {
                    type: "explain",
                    emoji: "ğŸ”“",
                    title: "keyReleased() - í‚¤ ë—„ ë•Œ",
                    content: `
                        <p><strong>keyReleased()</strong>ëŠ” í‚¤ë¥¼ ë—„ ë•Œ ì‹¤í–‰ë¼ìš”.</p>
                        <p>í‚¤ë¥¼ ë–¼ë©´ ì´ë™ì„ ë©ˆì¶°ì•¼ í•˜ë‹ˆê¹Œ falseë¡œ ë°”ê¿”ìš”!</p>
                    `,
                    code: `function keyReleased() {
    if (keyCode == 37) {  // ì™¼ìª½ í™”ì‚´í‘œ
        isLeft = false;   // ë©ˆì¶¤!
    }
    if (keyCode == 39) {  // ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ
        isRight = false;  // ë©ˆì¶¤!
    }
}`
                },
                {
                    type: "explain",
                    emoji: "ğŸƒ",
                    title: "ì‹¤ì œë¡œ ì›€ì§ì´ê¸°",
                    content: `
                        <p>draw() í•¨ìˆ˜ì—ì„œ isLeft/isRightë¥¼ í™•ì¸í•˜ê³  ìœ„ì¹˜ë¥¼ ë°”ê¿”ìš”!</p>
                    `,
                    code: `function draw() {
    // ... ë°°ê²½ ê·¸ë¦¬ê¸° ...

    // ì´ë™ ì²˜ë¦¬
    if (isLeft) {
        gameChar_x = gameChar_x - 5;
        // ë˜ëŠ” gameChar_x -= 5;
    }
    if (isRight) {
        gameChar_x = gameChar_x + 5;
    }

    // ... ìºë¦­í„° ê·¸ë¦¬ê¸° ...
}`
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ì›€ì§ì´ëŠ” ìºë¦­í„°",
                    content: `<p>draw() ì•ˆì— ì´ë™ ì½”ë“œë¥¼ ì¶”ê°€í•´ì„œ ìºë¦­í„°ê°€ ì›€ì§ì´ê²Œ í•´ë³´ì„¸ìš”!</p>`,
                    starterCode: `var gameChar_x = 100;
var gameChar_y = 150;
var isLeft = false;
var isRight = false;

function setup() {
    createCanvas(200, 200);
}

function draw() {
    background(100, 155, 255);
    noStroke();
    fill(0, 155, 0);
    rect(0, 150, 200, 50);

    // ì—¬ê¸°ì— ì´ë™ ì½”ë“œ ì¶”ê°€!
    // if (isLeft) { ... }
    // if (isRight) { ... }


    // ìºë¦­í„° ê·¸ë¦¬ê¸°
    fill(200, 150, 150);
    ellipse(gameChar_x, gameChar_y - 47, 25);
    fill(255, 0, 0);
    rect(gameChar_x - 13, gameChar_y - 35, 26, 30);
    fill(0);
    rect(gameChar_x - 18, gameChar_y - 35, 6, 20);
    rect(gameChar_x + 12, gameChar_y - 35, 6, 20);
    rect(gameChar_x - 15, gameChar_y - 6, 10, 10);
    rect(gameChar_x + 5, gameChar_y - 6, 10, 10);
}

function keyPressed() {
    if (keyCode == 37) isLeft = true;
    if (keyCode == 39) isRight = true;
}

function keyReleased() {
    if (keyCode == 37) isLeft = false;
    if (keyCode == 39) isRight = false;
}`,
                    targetCode: `if (isLeft) { gameChar_x -= 5; }`,
                    answerCheck: (code) => {
                        return code.includes('if') &&
                               code.includes('isLeft') &&
                               code.includes('gameChar_x');
                    },
                    hint: "if (isLeft) { gameChar_x -= 5; } if (isRight) { gameChar_x += 5; }",
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "í™•ì¸ í€´ì¦ˆ",
                    question: "keyCode == 37ì€ ì–´ë–¤ í‚¤ì¼ê¹Œìš”?",
                    options: [
                        "ìŠ¤í˜ì´ìŠ¤ë°”",
                        "Enter",
                        "ì™¼ìª½ í™”ì‚´í‘œ",
                        "ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ"
                    ],
                    correct: 2,
                    explanation: "37ì€ ì™¼ìª½ í™”ì‚´í‘œì˜ˆìš”. 39ëŠ” ì˜¤ë¥¸ìª½, 38ì€ ìœ„, 40ì€ ì•„ë˜, 32ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”ì˜ˆìš”."
                }
            ]
        },
        {
            day: 4,
            title: "ì í”„ & ì¤‘ë ¥",
            subtitle: "ìºë¦­í„° ì í”„ì‹œí‚¤ê¸°",
            icon: "ğŸ¦˜",
            xp: 80,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="highlight-box success">
                            ğŸ¦˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì í”„í•˜ê¸°!<br><br>
                            â€¢ ìŠ¤í˜ì´ìŠ¤ë°” ëˆ„ë¥´ë©´ ì í”„<br>
                            â€¢ ì¤‘ë ¥ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë–¨ì–´ì§€ê¸°<br>
                            â€¢ ê³µì¤‘ì—ì„œëŠ” ì í”„ ë¶ˆê°€
                        </div>
                    `
                },
                {
                    type: "explain",
                    emoji: "ğŸ¦˜",
                    title: "ì í”„ êµ¬í˜„í•˜ê¸°",
                    content: `
                        <p>ì í”„ëŠ” ìºë¦­í„°ì˜ <strong>Y ìœ„ì¹˜</strong>ë¥¼ ìœ„ë¡œ ì´ë™ì‹œì¼œìš”.</p>
                        <p>Yê°€ ì‘ì•„ì§€ë©´ ìœ„ë¡œ ì˜¬ë¼ê°€ìš”! (ì¢Œí‘œê³„ ê¸°ì–µí•˜ì„¸ìš”)</p>
                    `,
                    code: `var floorPos_y = 225;  // ë•… ìœ„ì¹˜
var isFalling = false;  // ë–¨ì–´ì§€ëŠ” ì¤‘?

function keyPressed() {
    // ìŠ¤í˜ì´ìŠ¤ë°”(32) & ë•…ì— ìˆì„ ë•Œë§Œ ì í”„
    if (keyCode == 32 && gameChar_y == floorPos_y) {
        gameChar_y -= 100;  // ìœ„ë¡œ 100 ì´ë™
        isFalling = true;
    }
}`
                },
                {
                    type: "explain",
                    emoji: "ğŸŒ",
                    title: "ì¤‘ë ¥ êµ¬í˜„í•˜ê¸°",
                    content: `
                        <p><strong>ì¤‘ë ¥</strong>ì€ ê³„ì†í•´ì„œ ìºë¦­í„°ë¥¼ ì•„ë˜ë¡œ ëŒì–´ë‹¹ê²¨ìš”.</p>
                        <p>draw()ì—ì„œ ë§¤ í”„ë ˆì„ë§ˆë‹¤ Yë¥¼ ì¦ê°€ì‹œì¼œìš”.</p>
                    `,
                    code: `var gravity = 2;  // ì¤‘ë ¥ ì„¸ê¸°

function draw() {
    // ... ê·¸ë¦¬ê¸° ì½”ë“œ ...

    // ì¤‘ë ¥ ì ìš©
    if (gameChar_y < floorPos_y) {
        // ë•…ë³´ë‹¤ ìœ„ì— ìˆìœ¼ë©´
        gameChar_y += gravity;  // ì•„ë˜ë¡œ
        isFalling = true;
    } else {
        // ë•…ì— ë‹¿ìœ¼ë©´
        gameChar_y = floorPos_y;  // ë•…ì— ê³ ì •
        isFalling = false;
    }
}`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ: ì¤‘ë ¥ ì¡°ê±´ë¬¸",
                    content: `<p>ìºë¦­í„°ê°€ ë•…(floorPos_y)ë³´ë‹¤ ìœ„ì— ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì¡°ê±´ë¬¸ì„ ì¨ë³´ì„¸ìš”.</p>`,
                    starterCode: `// gameChar_yê°€ floorPos_yë³´ë‹¤ ì‘ìœ¼ë©´
// (ìœ„ì— ìˆìœ¼ë©´) ì¤‘ë ¥ ì ìš©

`,
                    answer: "if (gameChar_y < floorPos_y)",
                    answerCheck: (code) => {
                        return code.includes('if') &&
                               code.includes('gameChar_y') &&
                               code.includes('<') &&
                               code.includes('floorPos_y');
                    },
                    hint: "< ëŠ” 'ë³´ë‹¤ ì‘ë‹¤'ëŠ” ëœ»ì´ì—ìš”. Yê°€ ì‘ìœ¼ë©´ ìœ„ì— ìˆëŠ” ê±°ì˜ˆìš”!"
                },
                {
                    type: "interactive",
                    emoji: "ğŸ–Œï¸",
                    title: "ì¤‘ë ¥ ì‹¤í—˜í•˜ê¸°",
                    content: `<p>gravity ê°’ì„ ë°”ê¿”ë³´ì„¸ìš”! í´ìˆ˜ë¡ ë¹¨ë¦¬ ë–¨ì–´ì ¸ìš”.</p>`,
                    defaultCode: `var y = 50;
var gravity = 2;  // ì´ ê°’ ë°”ê¿”ë³´ê¸°!
var floorY = 180;

background(100, 155, 255);
noStroke();
fill(0, 155, 0);
rect(0, 180, 200, 20);

// ì¤‘ë ¥ ì‹œë®¬ë ˆì´ì…˜
for (var i = 0; i < 10; i++) {
    fill(255, 100, 100, 150);
    ellipse(100, y, 20, 20);

    if (y < floorY) {
        y += gravity * (i + 1);
    }
}`,
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ì í”„í•˜ëŠ” ìºë¦­í„°",
                    content: `<p>ì í”„ì™€ ì¤‘ë ¥ ì½”ë“œë¥¼ ì¶”ê°€í•´ì„œ ìºë¦­í„°ê°€ ì í”„í•˜ê²Œ í•´ë³´ì„¸ìš”!</p>
                    <p class="editor-hint">ğŸ’¡ ìº”ë²„ìŠ¤ í´ë¦­ í›„ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>`,
                    starterCode: `var gameChar_x = 100;
var gameChar_y;
var floorPos_y = 150;
var gravity = 2;
var isFalling = false;

function setup() {
    createCanvas(200, 200);
    gameChar_y = floorPos_y;
}

function draw() {
    background(100, 155, 255);
    noStroke();
    fill(0, 155, 0);
    rect(0, 150, 200, 50);

    // ì¤‘ë ¥ ì ìš© - ì—¬ê¸° ì±„ìš°ê¸°!
    // if (gameChar_y < floorPos_y) { ... }


    // ìºë¦­í„°
    fill(200, 150, 150);
    ellipse(gameChar_x, gameChar_y - 47, 25);
    fill(255, 0, 0);
    rect(gameChar_x - 13, gameChar_y - 35, 26, 30);
    fill(0);
    rect(gameChar_x - 18, gameChar_y - 35, 6, 20);
    rect(gameChar_x + 12, gameChar_y - 35, 6, 20);
    rect(gameChar_x - 15, gameChar_y - 6, 10, 10);
    rect(gameChar_x + 5, gameChar_y - 6, 10, 10);
}

function keyPressed() {
    if (keyCode == 32 && gameChar_y == floorPos_y) {
        gameChar_y -= 80;
        isFalling = true;
    }
}`,
                    targetCode: `if (gameChar_y < floorPos_y) { gameChar_y += gravity; }`,
                    answerCheck: (code) => {
                        return code.includes('gameChar_y') &&
                               code.includes('gravity') &&
                               code.includes('floorPos_y');
                    },
                    hint: "ë•…ë³´ë‹¤ ìœ„ì— ìˆìœ¼ë©´(gameChar_y < floorPos_y) ì¤‘ë ¥ì„ ë”í•´ìš”(gameChar_y += gravity)",
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "í™•ì¸ í€´ì¦ˆ",
                    question: "gameChar_y += 2ëŠ” ìºë¦­í„°ë¥¼ ì–´ë””ë¡œ ì´ë™ì‹œí‚¬ê¹Œìš”?",
                    options: [
                        "ìœ„ë¡œ (Yê°€ ì‘ì•„ì ¸ì•¼ ìœ„)",
                        "ì•„ë˜ë¡œ (Yê°€ ì»¤ì§€ë©´ ì•„ë˜)",
                        "ì˜¤ë¥¸ìª½ìœ¼ë¡œ",
                        "ì™¼ìª½ìœ¼ë¡œ"
                    ],
                    correct: 1,
                    explanation: "p5.jsì—ì„œ Yê°€ ì»¤ì§€ë©´ ì•„ë˜ë¡œ ì´ë™í•´ìš”. += 2ëŠ” Yë¥¼ 2 ì¦ê°€ì‹œí‚¤ë‹ˆê¹Œ ì•„ë˜ë¡œ ì´ë™!"
                }
            ]
        },
        {
            day: 5,
            title: "ë°°ê²½ ê¾¸ë¯¸ê¸°",
            subtitle: "ë‚˜ë¬´, êµ¬ë¦„, ì‚° ê·¸ë¦¬ê¸°",
            icon: "ğŸŒ²",
            xp: 80,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="target-preview">
                            <h4>ğŸŒ² ë°°ê²½ ìš”ì†Œë“¤</h4>
                            <div class="target-canvas" id="day5-target"></div>
                        </div>
                        <p>ì‚°, êµ¬ë¦„, ë‚˜ë¬´ë¥¼ ê·¸ë ¤ì„œ ê²Œì„ ë°°ê²½ì„ ê¾¸ë©°ë³¼ ê±°ì˜ˆìš”!</p>
                    `,
                    targetDraw: (p) => {
                        p.background(100, 155, 255);
                        p.noStroke();
                        // Mountain
                        p.fill(0, 100, 0);
                        p.triangle(20, 150, 80, 50, 140, 150);
                        // Cloud
                        p.fill(255);
                        p.ellipse(160, 40, 40, 25);
                        p.ellipse(180, 40, 50, 30);
                        p.ellipse(200, 40, 40, 25);
                        // Ground
                        p.fill(0, 155, 0);
                        p.rect(0, 150, 250, 50);
                        // Tree
                        p.fill(130, 100, 0);
                        p.rect(180, 100, 20, 50);
                        p.fill(0, 150, 0);
                        p.triangle(160, 120, 190, 70, 220, 120);
                        p.triangle(160, 100, 190, 50, 220, 100);
                    }
                },
                {
                    type: "explain",
                    emoji: "ğŸ“š",
                    title: "ë°°ì—´ë¡œ ì—¬ëŸ¬ ê°œ ì €ì¥í•˜ê¸°",
                    content: `
                        <p><strong>ë°°ì—´</strong>ì€ ì—¬ëŸ¬ ê°’ì„ í•œ ë²ˆì— ì €ì¥í•´ìš”.</p>
                        <div class="highlight-box">
                            ë‚˜ë¬´ 10ê°œ ìœ„ì¹˜ë¥¼ ì €ì¥í•˜ë ¤ë©´?<br>
                            âŒ var tree1=100; var tree2=200; ...<br>
                            âœ… var trees = [100, 200, 300, ...];
                        </div>
                    `,
                    code: `// ë‚˜ë¬´ X ìœ„ì¹˜ë“¤
var trees_x = [100, 300, 500, 700];

// ê°’ ê°€ì ¸ì˜¤ê¸° (0ë¶€í„° ì‹œì‘!)
trees_x[0]  // 100 (ì²«ë²ˆì§¸)
trees_x[1]  // 300 (ë‘ë²ˆì§¸)
trees_x[3]  // 700 (ë„¤ë²ˆì§¸)`
                },
                {
                    type: "explain",
                    emoji: "ğŸ”„",
                    title: "forë¬¸ìœ¼ë¡œ ë°˜ë³µí•˜ê¸°",
                    content: `
                        <p><strong>forë¬¸</strong>ìœ¼ë¡œ ë°°ì—´ì˜ ëª¨ë“  ê°’ì„ ì²˜ë¦¬í•´ìš”.</p>
                    `,
                    code: `var trees_x = [100, 250, 400];

// ëª¨ë“  ë‚˜ë¬´ ê·¸ë¦¬ê¸°
for (var i = 0; i < trees_x.length; i++) {
    // trees_x[i] = í˜„ì¬ ë‚˜ë¬´ X ìœ„ì¹˜

    // ë‚˜ë¬´ ì¤„ê¸°
    fill(130, 100, 0);
    rect(trees_x[i], 200, 20, 50);

    // ë‚˜ë¬´ ì
    fill(0, 150, 0);
    triangle(
        trees_x[i] - 20, 220,
        trees_x[i] + 10, 170,
        trees_x[i] + 40, 220
    );
}`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ: forë¬¸ ì‘ì„±í•˜ê¸°",
                    content: `<p>ë°°ì—´ ê¸¸ì´ë§Œí¼ ë°˜ë³µí•˜ëŠ” forë¬¸ì„ ì™„ì„±í•˜ì„¸ìš”.</p>`,
                    starterCode: `var clouds = [50, 150, 250];

// clouds ë°°ì—´ ê¸¸ì´ë§Œí¼ ë°˜ë³µ

`,
                    answer: "for (var i = 0; i < clouds.length; i++)",
                    answerCheck: (code) => {
                        return code.includes('for') &&
                               code.includes('clouds.length') &&
                               code.includes('i++');
                    },
                    hint: "for (var i = 0; i < ë°°ì—´.length; i++) { ... }"
                },
                {
                    type: "explain",
                    emoji: "ğŸ“¦",
                    title: "ê°ì²´ë¡œ ì—¬ëŸ¬ ì •ë³´ ì €ì¥í•˜ê¸°",
                    content: `
                        <p><strong>ê°ì²´</strong>ëŠ” ì—¬ëŸ¬ ì†ì„±ì„ í•¨ê»˜ ì €ì¥í•´ìš”.</p>
                        <p>êµ¬ë¦„ì€ ìœ„ì¹˜(x, y)ì™€ í¬ê¸°(width, height)ê°€ í•„ìš”í•´ìš”!</p>
                    `,
                    code: `// êµ¬ë¦„ ê°ì²´ë“¤ì˜ ë°°ì—´
var clouds = [
    {x_pos: 100, y_pos: 80, width: 80},
    {x_pos: 300, y_pos: 60, width: 100},
    {x_pos: 500, y_pos: 90, width: 70}
];

// êµ¬ë¦„ ê·¸ë¦¬ê¸°
for (var i = 0; i < clouds.length; i++) {
    fill(255);  // í°ìƒ‰
    ellipse(clouds[i].x_pos, clouds[i].y_pos,
            clouds[i].width, 40);
}`
                },
                {
                    type: "interactive",
                    emoji: "ğŸ–Œï¸",
                    title: "êµ¬ë¦„ ê·¸ë¦¬ê¸°",
                    content: `<p>êµ¬ë¦„ ë°°ì—´ì— ê°’ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>`,
                    defaultCode: `background(100, 155, 255);
noStroke();

// êµ¬ë¦„ë“¤
var clouds = [
    {x: 50, y: 40},
    {x: 150, y: 30}
    // ì—¬ê¸°ì— ì¶”ê°€í•´ë³´ì„¸ìš”!
];

// êµ¬ë¦„ ê·¸ë¦¬ê¸°
for (var i = 0; i < clouds.length; i++) {
    fill(255);
    ellipse(clouds[i].x - 20, clouds[i].y, 30, 20);
    ellipse(clouds[i].x, clouds[i].y, 40, 25);
    ellipse(clouds[i].x + 20, clouds[i].y, 30, 20);
}

// ë•…
fill(0, 155, 0);
rect(0, 150, 250, 50);`,
                    canvasSize: { w: 250, h: 200 }
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ë‚˜ë¬´ ê·¸ë¦¬ê¸°",
                    content: `<p>forë¬¸ì„ ì™„ì„±í•´ì„œ ëª¨ë“  ë‚˜ë¬´ë¥¼ ê·¸ë ¤ë³´ì„¸ìš”!</p>`,
                    starterCode: `var trees_x = [50, 120, 200];

function setup() {
    createCanvas(250, 200);
}

function draw() {
    background(100, 155, 255);
    noStroke();
    fill(0, 155, 0);
    rect(0, 150, 250, 50);

    // ë‚˜ë¬´ ê·¸ë¦¬ê¸° - forë¬¸ ì™„ì„±í•˜ê¸°!
    for (var i = 0; i < trees_x.length; i++) {
        // ë‚˜ë¬´ ì¤„ê¸° (ê°ˆìƒ‰)
        fill(130, 100, 0);
        // rect ì¶”ê°€!


        // ë‚˜ë¬´ ì (ì´ˆë¡)
        fill(0, 150, 0);
        triangle(
            trees_x[i] - 15, 130,
            trees_x[i] + 10, 90,
            trees_x[i] + 35, 130
        );
    }
}`,
                    targetCode: `rect(trees_x[i], 130, 20, 30)`,
                    answerCheck: (code) => {
                        return code.includes('rect') &&
                               code.includes('trees_x[i]');
                    },
                    hint: "rect(trees_x[i], yìœ„ì¹˜, ê°€ë¡œ, ì„¸ë¡œ) - trees_x[i]ê°€ í˜„ì¬ ë‚˜ë¬´ Xìœ„ì¹˜ì˜ˆìš”",
                    canvasSize: { w: 250, h: 200 }
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "í™•ì¸ í€´ì¦ˆ",
                    question: "var arr = [10, 20, 30]; ì¼ ë•Œ arr.lengthëŠ”?",
                    options: [
                        "2",
                        "3",
                        "30",
                        "undefined"
                    ],
                    correct: 1,
                    explanation: "lengthëŠ” ë°°ì—´ì˜ ê¸¸ì´(ìš”ì†Œ ê°œìˆ˜)ë¥¼ ë°˜í™˜í•´ìš”. [10, 20, 30]ì€ 3ê°œì˜ ìš”ì†Œê°€ ìˆìœ¼ë‹ˆ 3!"
                }
            ]
        },
        {
            day: 6,
            title: "ì•„ì´í…œ & í˜‘ê³¡",
            subtitle: "ìˆ˜ì§‘ & ì¥ì• ë¬¼",
            icon: "ğŸ’",
            xp: 90,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="highlight-box success">
                            ğŸ’ ì•„ì´í…œ ìˆ˜ì§‘í•˜ê¸°<br>
                            â€¢ ìºë¦­í„°ê°€ ì•„ì´í…œì— ë‹¿ìœ¼ë©´ ì‚¬ë¼ì§<br><br>
                            ğŸ•³ï¸ í˜‘ê³¡(êµ¬ë©ì´)<br>
                            â€¢ ë¹ ì§€ë©´ ë–¨ì–´ì§!
                        </div>
                    `
                },
                {
                    type: "explain",
                    emoji: "ğŸ“",
                    title: "dist() - ê±°ë¦¬ ê³„ì‚°í•˜ê¸°",
                    content: `
                        <p><strong>dist(x1, y1, x2, y2)</strong>ëŠ” ë‘ ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•´ìš”.</p>
                        <p>ìºë¦­í„°ì™€ ì•„ì´í…œì´ ê°€ê¹Œìš°ë©´ ìˆ˜ì§‘!</p>
                    `,
                    code: `var collectable = {
    x_pos: 300,
    y_pos: 200,
    isFound: false
};

// ê±°ë¦¬ ê³„ì‚°
var distance = dist(
    gameChar_x, gameChar_y,
    collectable.x_pos, collectable.y_pos
);

// ê±°ë¦¬ê°€ 20 ë¯¸ë§Œì´ë©´ ìˆ˜ì§‘!
if (distance < 20) {
    collectable.isFound = true;
}`
                },
                {
                    type: "practice",
                    emoji: "âœï¸",
                    title: "ì—°ìŠµ: ê±°ë¦¬ ì¡°ê±´ë¬¸",
                    content: `<p>ë‘ ì  ì‚¬ì´ ê±°ë¦¬ê°€ 30 ë¯¸ë§Œì¸ì§€ í™•ì¸í•˜ëŠ” ì¡°ê±´ë¬¸ì„ ì¨ë³´ì„¸ìš”.</p>`,
                    starterCode: `var d = dist(x1, y1, x2, y2);

// ê±°ë¦¬ê°€ 30 ë¯¸ë§Œì´ë©´ ì¶©ëŒ!

`,
                    answer: "if (d < 30)",
                    answerCheck: (code) => {
                        return code.includes('if') &&
                               code.includes('d') &&
                               code.includes('<') &&
                               code.includes('30');
                    },
                    hint: "if (ê±°ë¦¬ë³€ìˆ˜ < ìˆ«ì) { ... }"
                },
                {
                    type: "explain",
                    emoji: "ğŸ•³ï¸",
                    title: "í˜‘ê³¡ ë§Œë“¤ê¸°",
                    content: `
                        <p>í˜‘ê³¡ì€ ë•…ì— êµ¬ë©ì„ ë§Œë“¤ì–´ìš”.</p>
                        <p>ìºë¦­í„°ê°€ í˜‘ê³¡ ìœ„ì— ìˆìœ¼ë©´ ë–¨ì–´ì ¸ìš”!</p>
                    `,
                    code: `var canyon = {x_pos: 200, width: 80};
var isPlummeting = false;  // ì¶”ë½ì¤‘?

// í˜‘ê³¡ ê·¸ë¦¬ê¸° (íŒŒë€ ë¬¼)
fill(40, 130, 255);
rect(canyon.x_pos, floorPos_y, canyon.width, 100);

// ìºë¦­í„°ê°€ í˜‘ê³¡ ìœ„ì— ìˆëŠ”ì§€ í™•ì¸
if (gameChar_x > canyon.x_pos &&
    gameChar_x < canyon.x_pos + canyon.width) {
    isPlummeting = true;  // ì¶”ë½!
}

// ì¶”ë½ì¤‘ì´ë©´ ê³„ì† ë–¨ì–´ì§
if (isPlummeting) {
    gameChar_y += 10;
}`
                },
                {
                    type: "interactive",
                    emoji: "ğŸ–Œï¸",
                    title: "ì•„ì´í…œ ìˆ˜ì§‘ ì‹¤í—˜",
                    content: `<p>ìºë¦­í„° ìœ„ì¹˜(charX)ë¥¼ ë°”ê¿”ì„œ ì•„ì´í…œì„ ìˆ˜ì§‘í•´ë³´ì„¸ìš”!</p>`,
                    defaultCode: `var charX = 50;  // ì´ ê°’ì„ ë°”ê¿”ë³´ì„¸ìš”!
var charY = 130;
var itemX = 150;
var itemY = 130;
var isFound = false;

background(100, 155, 255);
noStroke();
fill(0, 155, 0);
rect(0, 150, 250, 50);

// ê±°ë¦¬ ê³„ì‚°
var d = dist(charX, charY, itemX, itemY);
if (d < 30) {
    isFound = true;
}

// ì•„ì´í…œ (ìˆ˜ì§‘ ì•ˆëìœ¼ë©´ ë³´ì„)
if (!isFound) {
    fill(255, 200, 0);
    ellipse(itemX, itemY, 25, 25);
}

// ìºë¦­í„°
fill(200, 150, 150);
ellipse(charX, charY - 20, 20);
fill(255, 0, 0);
rect(charX - 8, charY - 10, 16, 20);

// ê±°ë¦¬ í‘œì‹œ
fill(255);
textSize(12);
text("ê±°ë¦¬: " + Math.round(d), 10, 20);`,
                    canvasSize: { w: 250, h: 200 }
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ì•„ì´í…œ ìˆ˜ì§‘",
                    content: `<p>dist()ë¥¼ ì‚¬ìš©í•´ì„œ ì•„ì´í…œ ìˆ˜ì§‘ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>`,
                    starterCode: `var gameChar_x = 100;
var item = {x: 150, y: 130, isFound: false};

function setup() {
    createCanvas(250, 200);
}

function draw() {
    background(100, 155, 255);
    noStroke();
    fill(0, 155, 0);
    rect(0, 150, 250, 50);

    // ì•„ì´í…œ ìˆ˜ì§‘ ì²´í¬ - ì—¬ê¸° ì™„ì„±!
    // dist()ë¡œ ê±°ë¦¬ ê³„ì‚°í•˜ê³ 
    // ê±°ë¦¬ê°€ 25 ë¯¸ë§Œì´ë©´ isFound = true


    // ì•„ì´í…œ ê·¸ë¦¬ê¸°
    if (item.isFound == false) {
        fill(255, 200, 0);
        ellipse(item.x, item.y, 25, 25);
    }

    // ìºë¦­í„°
    fill(200, 150, 150);
    ellipse(gameChar_x, 130, 20);
    fill(255, 0, 0);
    rect(gameChar_x - 8, 120, 16, 20);
}

function keyPressed() {
    if (keyCode == 39) gameChar_x += 20;
    if (keyCode == 37) gameChar_x -= 20;
}`,
                    targetCode: `if (dist(gameChar_x, 130, item.x, item.y) < 25)`,
                    answerCheck: (code) => {
                        return code.includes('dist') &&
                               code.includes('gameChar_x') &&
                               code.includes('item') &&
                               code.includes('isFound');
                    },
                    hint: "if (dist(gameChar_x, y, item.x, item.y) < 25) { item.isFound = true; }",
                    canvasSize: { w: 250, h: 200 }
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "í™•ì¸ í€´ì¦ˆ",
                    question: "dist(0, 0, 3, 4)ì˜ ê²°ê³¼ëŠ”?",
                    options: [
                        "7",
                        "5",
                        "12",
                        "1"
                    ],
                    correct: 1,
                    explanation: "í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬! âˆš(3Â² + 4Â²) = âˆš(9 + 16) = âˆš25 = 5"
                }
            ]
        },
        {
            day: 7,
            title: "ì¹´ë©”ë¼ ìŠ¤í¬ë¡¤",
            subtitle: "ì„¸ìƒì„ ë„“íˆê¸°",
            icon: "ğŸ¥",
            xp: 100,
            steps: [
                {
                    type: "intro",
                    emoji: "ğŸ¯",
                    title: "ì˜¤ëŠ˜ì˜ ëª©í‘œ",
                    content: `
                        <p>ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë§Œë“¤ ê²ƒ:</p>
                        <div class="highlight-box success">
                            ğŸ¥ ì¹´ë©”ë¼ ìŠ¤í¬ë¡¤!<br><br>
                            â€¢ ìºë¦­í„°ê°€ í™”ë©´ ì¤‘ì•™ì— ìˆìŒ<br>
                            â€¢ ë°°ê²½ì´ ì›€ì§ì´ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì„<br>
                            â€¢ ë” ë„“ì€ ê²Œì„ ì„¸ê³„!
                        </div>
                    `
                },
                {
                    type: "explain",
                    emoji: "ğŸ¥",
                    title: "translate() - í™”ë©´ ì´ë™",
                    content: `
                        <p><strong>translate(x, y)</strong>ëŠ” ì¢Œí‘œê³„ë¥¼ ì´ë™ì‹œì¼œìš”.</p>
                        <p>ìºë¦­í„°ë¥¼ ë”°ë¼ í™”ë©´ì„ ì´ë™ì‹œí‚¤ë©´ ìŠ¤í¬ë¡¤ íš¨ê³¼!</p>
                    `,
                    code: `// ì¹´ë©”ë¼ ìœ„ì¹˜ = ìºë¦­í„° - í™”ë©´ ì ˆë°˜
var cameraPosX = gameChar_x - width/2;

// ì¢Œí‘œê³„ ì´ë™
push();  // ìƒíƒœ ì €ì¥
translate(-cameraPosX, 0);

// ì—¬ê¸°ì— ë°°ê²½ ê·¸ë¦¬ê¸°
// (ë‚˜ë¬´, êµ¬ë¦„, ì‚°, í˜‘ê³¡ ë“±)

pop();   // ìƒíƒœ ë³µì›`
                },
                {
                    type: "explain",
                    emoji: "ğŸ’¾",
                    title: "push() & pop()",
                    content: `
                        <p><strong>push()</strong>ëŠ” í˜„ì¬ ì„¤ì •ì„ ì €ì¥í•´ìš”.</p>
                        <p><strong>pop()</strong>ì€ ì €ì¥í•œ ì„¤ì •ì„ ë³µì›í•´ìš”.</p>
                        <div class="highlight-box">
                            <strong>ì™œ í•„ìš”í• ê¹Œìš”?</strong><br>
                            translate í›„ ì›ë˜ëŒ€ë¡œ ëŒì•„ê°€ì•¼<br>
                            ìºë¦­í„°ê°€ í™”ë©´ ì¤‘ì•™ì— ê·¸ë ¤ì ¸ìš”!
                        </div>
                    `,
                    code: `function draw() {
    background(100, 155, 255);

    cameraPosX = gameChar_x - width/2;

    push();
    translate(-cameraPosX, 0);

    // === ìŠ¤í¬ë¡¤ë˜ëŠ” ê²ƒë“¤ ===
    // ë•…, ë‚˜ë¬´, êµ¬ë¦„, ì‚°, ì•„ì´í…œ, í˜‘ê³¡

    pop();

    // === ìŠ¤í¬ë¡¤ ì•ˆ ë˜ëŠ” ê²ƒë“¤ ===
    // UI, ì ìˆ˜ ë“±
}`
                },
                {
                    type: "interactive",
                    emoji: "ğŸ–Œï¸",
                    title: "translate ì‹¤í—˜",
                    content: `<p>translateX ê°’ì„ ë°”ê¿”ë³´ì„¸ìš”! ë°°ê²½ì´ ì›€ì§ì—¬ìš”.</p>`,
                    defaultCode: `var translateX = 0;  // ë°”ê¿”ë³´ì„¸ìš”!

background(100, 155, 255);
noStroke();

push();
translate(-translateX, 0);

// ë°°ê²½ (ìŠ¤í¬ë¡¤ë¨)
fill(0, 155, 0);
rect(0, 150, 500, 50);

// ë‚˜ë¬´ë“¤
fill(130, 100, 0);
rect(50, 100, 20, 50);
rect(150, 100, 20, 50);
rect(250, 100, 20, 50);
rect(350, 100, 20, 50);

fill(0, 150, 0);
for (var x = 50; x <= 350; x += 100) {
    triangle(x-15, 120, x+10, 70, x+35, 120);
}

pop();

// ìºë¦­í„° (ìŠ¤í¬ë¡¤ ì•ˆë¨, ì¤‘ì•™ì— ê³ ì •)
fill(200, 150, 150);
ellipse(100, 130, 20);
fill(255, 0, 0);
rect(92, 120, 16, 20);`,
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "build",
                    emoji: "ğŸ”¨",
                    title: "ì§ì ‘ ë§Œë“¤ê¸°: ì¹´ë©”ë¼ ìŠ¤í¬ë¡¤",
                    content: `<p>push, translate, popì„ ì‚¬ìš©í•´ì„œ ìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•´ë³´ì„¸ìš”!</p>
                    <p class="editor-hint">ğŸ’¡ ìº”ë²„ìŠ¤ í´ë¦­ í›„ â†â†’ í™”ì‚´í‘œë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>`,
                    starterCode: `var gameChar_x = 200;
var cameraPosX = 0;

function setup() {
    createCanvas(200, 200);
}

function draw() {
    background(100, 155, 255);
    noStroke();

    cameraPosX = gameChar_x - width/2;

    // ì—¬ê¸°ì— push, translate, pop ì¶”ê°€!


    // ë•… (ë„“ê²Œ!)
    fill(0, 155, 0);
    rect(0, 150, 600, 50);

    // ë‚˜ë¬´ë“¤
    fill(130, 100, 0);
    for (var x = 50; x <= 500; x += 100) {
        rect(x, 100, 20, 50);
    }

    // translate ëë‚˜ëŠ” ê³³ì— pop!


    // ìºë¦­í„° (í™”ë©´ ì¤‘ì•™ì—!)
    fill(200, 150, 150);
    ellipse(width/2, 130, 20);
    fill(255, 0, 0);
    rect(width/2 - 8, 120, 16, 20);
}

function keyPressed() {
    if (keyCode == 37) gameChar_x -= 30;
    if (keyCode == 39) gameChar_x += 30;
}`,
                    targetCode: `push(); translate(-cameraPosX, 0);`,
                    answerCheck: (code) => {
                        return code.includes('push()') &&
                               code.includes('translate') &&
                               code.includes('cameraPosX') &&
                               code.includes('pop()');
                    },
                    hint: "push(); translate(-cameraPosX, 0); ... pop();",
                    canvasSize: { w: 200, h: 200 }
                },
                {
                    type: "intro",
                    emoji: "ğŸ“",
                    title: "ì¶•í•˜í•´ìš”!",
                    content: `
                        <p>7ì¼ ë™ì•ˆ ê²Œì„ì„ ë§Œë“¤ì—ˆì–´ìš”!</p>
                        <div class="highlight-box success">
                            âœ… Day 1: ìº”ë²„ìŠ¤ & ë°°ê²½<br>
                            âœ… Day 2: ìºë¦­í„° ê·¸ë¦¬ê¸°<br>
                            âœ… Day 3: í‚¤ë³´ë“œ ì…ë ¥<br>
                            âœ… Day 4: ì í”„ & ì¤‘ë ¥<br>
                            âœ… Day 5: ë°°ê²½ ê¾¸ë¯¸ê¸°<br>
                            âœ… Day 6: ì•„ì´í…œ & í˜‘ê³¡<br>
                            âœ… Day 7: ì¹´ë©”ë¼ ìŠ¤í¬ë¡¤
                        </div>
                        <p>ì´ì œ ê²Œì„ í”„ë¡œì íŠ¸ ì½”ë“œë¥¼ ì´í•´í•  ìˆ˜ ìˆì–´ìš”! ğŸ®</p>
                    `
                },
                {
                    type: "quiz",
                    emoji: "ğŸ§ ",
                    title: "ë§ˆì§€ë§‰ í€´ì¦ˆ",
                    question: "translate() ì‚¬ìš© í›„ ì›ë˜ëŒ€ë¡œ ëŒë¦¬ë ¤ë©´?",
                    options: [
                        "reset()",
                        "pop()",
                        "restore()",
                        "undo()"
                    ],
                    correct: 1,
                    explanation: "push()ë¡œ ì €ì¥í•˜ê³  pop()ìœ¼ë¡œ ë³µì›í•´ìš”. translate ì „ì— push, í›„ì— pop!"
                }
            ]
        }
    ];

    // ==========================================
    // STATE
    // ==========================================
    let state = {
        xp: 0,
        streak: 0,
        completedDays: [],
        dayProgress: {},
        lastVisit: null
    };

    let currentDay = null;
    let currentStep = 0;
    let quizAnswered = false;
    let currentP5Instance = null;
    let codeEditor = null;
    let wrongAttempts = 0;

    // ==========================================
    // INIT
    // ==========================================
    function init() {
        loadState();
        checkStreak();
        renderHome();
        updateStats();
        drawFinalGamePreview();
        checkApiKey();

        // Auto-collapse sidebar on mobile
        if (window.innerWidth <= 1200) {
            toggleAISidebar();
        }
    }

    function loadState() {
        const saved = localStorage.getItem('p5js_game_v4');
        if (saved) {
            state = { ...state, ...JSON.parse(saved) };
        }
    }

    function saveState() {
        localStorage.setItem('p5js_game_v4', JSON.stringify(state));
    }

    // ==========================================
    // SETTINGS & API
    // ==========================================
    function openSettings() {
        const modal = document.getElementById('settings-modal');
        const input = document.getElementById('api-key-input');
        const savedKey = localStorage.getItem('gemini_api_key');
        if (savedKey) input.value = savedKey;
        modal.style.display = 'flex';
    }

    function closeSettings() {
        document.getElementById('settings-modal').style.display = 'none';
    }

    function saveSettings() {
        const key = document.getElementById('api-key-input').value.trim();
        if (key) {
            localStorage.setItem('gemini_api_key', key);
        } else {
            localStorage.removeItem('gemini_api_key');
        }
        closeSettings();
    }

    function toggleApiKeyVisibility() {
        const input = document.getElementById('api-key-input');
        input.type = input.type === 'password' ? 'text' : 'password';
    }

    // AI Sidebar
    let aiChatHistory = [];
    let aiSidebarCollapsed = false;

    function toggleAISidebar() {
        const sidebar = document.getElementById('ai-sidebar');
        const toggle = document.getElementById('ai-sidebar-toggle');
        const wrapper = document.getElementById('main-wrapper');

        aiSidebarCollapsed = !aiSidebarCollapsed;

        if (aiSidebarCollapsed) {
            sidebar.classList.add('collapsed');
            toggle.classList.add('collapsed');
            toggle.innerHTML = 'â–¶';
            wrapper.classList.add('sidebar-collapsed');
        } else {
            sidebar.classList.remove('collapsed');
            toggle.classList.remove('collapsed');
            toggle.innerHTML = 'â—€';
            wrapper.classList.remove('sidebar-collapsed');
        }
    }

    // Check API key on load and show warning if needed
    function checkApiKey() {
        const apiKey = localStorage.getItem('gemini_api_key');
        const messagesDiv = document.getElementById('ai-chat-messages');
        if (!apiKey && messagesDiv) {
            messagesDiv.innerHTML = `
                <div class="ai-chat-message ai">
                    <div class="avatar"></div>
                    <div class="bubble">AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! âš™ï¸<br><br><button onclick="openSettings()" style="background:var(--primary);border:none;color:white;padding:8px 16px;border-radius:6px;cursor:pointer;">ì„¤ì • ì—´ê¸°</button></div>
                </div>
            `;
        }
    }

    async function sendAIMessage() {
        const apiKey = localStorage.getItem('gemini_api_key');
        if (!apiKey) {
            alert('API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            openSettings();
            return;
        }

        const input = document.getElementById('ai-chat-input');
        const messagesDiv = document.getElementById('ai-chat-messages');
        const userMessage = input.value.trim();

        if (!userMessage) return;

        // Add user message to UI
        messagesDiv.innerHTML += `
            <div class="ai-chat-message user">
                <div class="avatar">ğŸ‘¤</div>
                <div class="bubble">${escapeHtml(userMessage)}</div>
            </div>
        `;
        input.value = '';

        // Add loading indicator
        messagesDiv.innerHTML += `<div class="ai-loading" id="ai-loading">Geminiê°€ ìƒê°í•˜ëŠ” ì¤‘...</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        // Build context
        const step = currentDay.steps[currentStep];
        const userCode = codeEditor ? codeEditor.getValue() : '';

        // Add to history
        aiChatHistory.push({ role: 'user', parts: [{ text: userMessage }] });

        const systemContext = `ë‹¹ì‹ ì€ ì¹œì ˆí•œ p5.js í”„ë¡œê·¸ë˜ë° íŠœí„°ì…ë‹ˆë‹¤.
- ì •ë‹µì„ ì§ì ‘ ì•Œë ¤ì£¼ì§€ ë§ê³  íŒíŠ¸ë¡œ ìœ ë„í•˜ì„¸ìš”
- ì‰¬ìš´ í•œêµ­ì–´ë¡œ ì§§ê²Œ ì„¤ëª…í•˜ì„¸ìš” (2-4ë¬¸ì¥)
- ê²©ë ¤í•˜ëŠ” ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”

í˜„ì¬ ë¬¸ì œ: ${step.question || step.instruction || step.title}
${step.hint ? `íŒíŠ¸: ${step.hint}` : ''}
${step.answer ? `ì •ë‹µ: ${step.answer}` : ''}

í•™ìƒì˜ ì½”ë“œ:
\`\`\`javascript
${userCode}
\`\`\``;

        try {
            const apiKey = localStorage.getItem('gemini_api_key');
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [
                        { role: 'user', parts: [{ text: systemContext }] },
                        { role: 'model', parts: [{ text: 'ë„¤, ì´í•´í–ˆìŠµë‹ˆë‹¤. í•™ìƒì„ ë„ì™€ë“œë¦´ê²Œìš”!' }] },
                        ...aiChatHistory
                    ],
                    generationConfig: { maxOutputTokens: 2048 }
                })
            });

            const data = await response.json();
            console.log('API Response:', data);

            // Remove loading
            document.getElementById('ai-loading')?.remove();

            if (data.error) {
                throw new Error(data.error.message);
            }

            const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || 'ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆì–´ìš”.';

            // Add to history
            aiChatHistory.push({ role: 'model', parts: [{ text: aiResponse }] });

            // Add AI message to UI
            messagesDiv.innerHTML += `
                <div class="ai-chat-message ai">
                    <div class="avatar"></div>
                    <div class="bubble">${aiResponse.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

        } catch (error) {
            console.error('AI Chat Error:', error);
            document.getElementById('ai-loading')?.remove();
            messagesDiv.innerHTML += `
                <div class="ai-chat-message ai">
                    <div class="avatar"></div>
                    <div class="bubble" style="border: 1px solid #f28b82;">âŒ ì˜¤ë¥˜: ${error.message}</div>
                </div>
            `;
        }
    }

    // Legacy function - show sidebar on hint request
    function getAIHint(problemType) {
        if (aiSidebarCollapsed) toggleAISidebar();
    }

    function checkStreak() {
        const today = new Date().toDateString();
        if (state.lastVisit !== today) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (state.lastVisit === yesterday.toDateString()) {
                state.streak++;
            } else {
                state.streak = 1;
            }
            state.lastVisit = today;
            saveState();
        }
    }

    function updateStats() {
        document.getElementById('xp-display').textContent = state.xp;
        document.getElementById('streak-display').textContent = state.streak;
    }

    function drawFinalGamePreview() {
        const container = document.getElementById('final-game-preview');
        new p5((p) => {
            let charX = 150;
            let dir = 1;
            p.setup = function() {
                p.createCanvas(300, 150);
            };
            p.draw = function() {
                p.background(100, 155, 255);
                p.noStroke();

                // Mountain
                p.fill(0, 100, 0);
                p.triangle(20, 112, 70, 40, 120, 112);
                p.triangle(200, 112, 260, 30, 320, 112);

                // Cloud
                p.fill(255);
                p.ellipse(180, 30, 40, 20);
                p.ellipse(200, 30, 50, 25);
                p.ellipse(220, 30, 40, 20);

                // Ground
                p.fill(0, 155, 0);
                p.rect(0, 112, 300, 38);

                // Tree
                p.fill(130, 100, 0);
                p.rect(250, 75, 15, 37);
                p.fill(0, 150, 0);
                p.triangle(235, 90, 257, 50, 280, 90);

                // Character
                charX += dir * 0.5;
                if (charX > 250 || charX < 50) dir *= -1;

                p.fill(200, 150, 150);
                p.ellipse(charX, 112 - 35, 18);
                p.fill(255, 0, 0);
                p.rect(charX - 9, 112 - 26, 18, 22);
                p.fill(0);
                p.rect(charX - 12, 112 - 26, 4, 15);
                p.rect(charX + 8, 112 - 26, 4, 15);
                p.rect(charX - 10, 112 - 5, 7, 7);
                p.rect(charX + 3, 112 - 5, 7, 7);

                // Collectable
                p.fill(255, 200, 0);
                p.ellipse(100, 95, 15);
            };
        }, container);
    }

    // ==========================================
    // HOME
    // ==========================================
    function renderHome() {
        const list = document.getElementById('day-list');
        list.innerHTML = '';

        LESSONS.forEach((lesson, idx) => {
            const isCompleted = state.completedDays.includes(lesson.day);
            const isLocked = idx > 0 && !state.completedDays.includes(LESSONS[idx-1].day);
            const progress = state.dayProgress[lesson.day] || 0;

            const item = document.createElement('div');
            item.className = `day-item ${isCompleted ? 'completed' : ''} ${isLocked ? 'locked' : ''}`;
            item.innerHTML = `
                <div class="day-icon">${lesson.icon}</div>
                <div class="day-info">
                    <h3>Day ${lesson.day}: ${lesson.title}</h3>
                    <p>${lesson.subtitle}</p>
                </div>
                <div class="day-progress">
                    ${isCompleted ? 'âœ… ì™„ë£Œ' : isLocked ? 'ğŸ”’' : `${progress}/${lesson.steps.length}`}
                </div>
            `;
            if (!isLocked) {
                item.onclick = () => startLesson(lesson.day);
            }
            list.appendChild(item);
        });
    }

    function goHome() {
        if (currentP5Instance) {
            currentP5Instance.remove();
            currentP5Instance = null;
        }
        document.getElementById('home-screen').classList.remove('hidden');
        document.getElementById('lesson-screen').classList.remove('active');
        renderHome();
    }

    // ==========================================
    // LESSON
    // ==========================================
    function startLesson(dayNum) {
        currentDay = LESSONS.find(l => l.day === dayNum);
        currentStep = state.dayProgress[dayNum] || 0;
        if (currentStep >= currentDay.steps.length) currentStep = 0;

        document.getElementById('home-screen').classList.add('hidden');
        document.getElementById('lesson-screen').classList.add('active');
        document.getElementById('lesson-title-text').textContent = `Day ${currentDay.day}: ${currentDay.title}`;
        document.getElementById('lesson-subtitle-text').textContent = currentDay.subtitle;

        renderProgress();
        renderStep();
    }

    function renderProgress() {
        const container = document.getElementById('progress-steps');
        container.innerHTML = '';
        currentDay.steps.forEach((_, idx) => {
            const step = document.createElement('div');
            step.className = 'progress-step';
            if (idx < currentStep) step.classList.add('completed');
            if (idx === currentStep) step.classList.add('current');
            container.appendChild(step);
        });
        document.getElementById('progress-text').textContent = `${currentStep + 1} / ${currentDay.steps.length}`;
    }

    function renderStep() {
        if (currentP5Instance) {
            currentP5Instance.remove();
            currentP5Instance = null;
        }
        codeEditor = null;
        wrongAttempts = 0;

        const step = currentDay.steps[currentStep];
        const content = document.getElementById('step-content');
        quizAnswered = false;

        let html = `
            <div class="step-emoji">${step.emoji}</div>
            <h3 class="step-title">${step.title}</h3>
            <div class="step-content">${step.content || ''}</div>
        `;

        // Code display for explain type
        if (step.type === 'explain' && step.code) {
            html += `<div class="code-readonly">${escapeHtml(step.code)}</div>`;
        }

        // Interactive editor
        if (step.type === 'interactive' || step.type === 'build') {
            html += `
                <div class="code-preview-container">
                    <div class="code-section">
                        <div class="code-label">ğŸ’» ì½”ë“œ</div>
                        <div class="cm-wrapper"><div id="code-editor-container"></div></div>
                    </div>
                    <div class="preview-section">
                        <div class="preview-label">ğŸ‘ï¸ ê²°ê³¼</div>
                        <div class="preview-canvas-wrapper" id="preview-canvas"></div>
                    </div>
                </div>
                <div class="btn-group" style="margin-bottom: 15px;">
                    <button class="btn btn-run" onclick="runCode()">â–¶ ì‹¤í–‰</button>
                </div>
            `;
            if (step.type === 'build') {
                html += `
                    <div class="code-result" id="build-result"></div>
                    <div class="btn-group" id="build-btns">
                        <button class="btn btn-check" onclick="checkBuild()">í™•ì¸í•˜ê¸° âœ“</button>
                        <button class="ai-hint-btn" onclick="getAIHint('build')">ğŸ¤– AI íŒíŠ¸</button>
                    </div>
                `;
                if (step.hint) {
                    html += `<p class="editor-hint">ğŸ’¡ íŒíŠ¸: ${step.hint}</p>`;
                }
                html += `<div id="ai-hint-container"></div>`;
            }
        }

        // Practice
        if (step.type === 'practice') {
            html += `
                <div class="code-section">
                    <div class="code-label">ğŸ’» ì½”ë“œ ì…ë ¥</div>
                    <div class="code-editor" id="practice-editor-wrapper">
                        <div id="practice-editor-container"></div>
                        <div class="code-result" id="practice-result"></div>
                    </div>
                </div>
                <div class="btn-group" id="practice-btns">
                    <button class="btn btn-check" onclick="checkPractice()">í™•ì¸í•˜ê¸° âœ“</button>
                    <button class="ai-hint-btn" onclick="getAIHint('practice')">ğŸ¤– AI íŒíŠ¸</button>
                </div>
                <p class="editor-hint">ğŸ’¡ íŒíŠ¸: ${step.hint}</p>
                <div id="ai-hint-container"></div>
            `;
        }

        // Quiz
        if (step.type === 'quiz') {
            html += `
                <p style="font-size: 1.1rem; margin-bottom: 20px;">${step.question}</p>
                <div class="quiz-options" id="quiz-options">
                    ${step.options.map((opt, idx) => `
                        <div class="quiz-option" onclick="selectQuiz(${idx})">${String.fromCharCode(65 + idx)}. ${opt}</div>
                    `).join('')}
                </div>
                <div id="quiz-explanation" style="display:none; margin-top: 20px;"></div>
            `;
        }

        content.innerHTML = html;

        // Update buttons
        const btnGroup = document.getElementById('btn-group');
        if (step.type === 'practice' || step.type === 'build') {
            btnGroup.innerHTML = '';
        } else if (step.type === 'quiz') {
            btnGroup.innerHTML = `<button class="btn btn-primary" id="next-btn" onclick="nextStep()" disabled>ë‹¤ìŒ â†’</button>`;
        } else {
            btnGroup.innerHTML = `<button class="btn btn-primary" onclick="nextStep()">ë‹¤ìŒ â†’</button>`;
        }

        // Initialize CodeMirror
        setTimeout(() => {
            if (step.type === 'interactive' || step.type === 'build') {
                const el = document.getElementById('code-editor-container');
                if (el) {
                    codeEditor = CodeMirror(el, {
                        value: step.starterCode || step.defaultCode || '',
                        mode: 'javascript',
                        theme: 'dracula',
                        lineNumbers: true,
                        matchBrackets: true,
                        autoCloseBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                    runCode();
                }
            }
            if (step.type === 'practice') {
                const el = document.getElementById('practice-editor-container');
                if (el) {
                    codeEditor = CodeMirror(el, {
                        value: step.starterCode || '',
                        mode: 'javascript',
                        theme: 'dracula',
                        lineNumbers: true,
                        matchBrackets: true,
                        autoCloseBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        lineWrapping: true
                    });
                }
            }
            // Draw target preview
            if (step.targetDraw) {
                const targetContainer = document.getElementById(`day${currentDay.day}-target`);
                if (targetContainer) {
                    new p5((p) => {
                        p.setup = function() {
                            p.createCanvas(250, 180);
                            p.noLoop();
                        };
                        p.draw = function() {
                            step.targetDraw(p);
                        };
                    }, targetContainer);
                }
            }
        }, 50);
    }

    function escapeHtml(text) {
        return text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    // ==========================================
    // CODE EXECUTION
    // ==========================================
    function runCode() {
        const step = currentDay.steps[currentStep];
        const code = codeEditor ? codeEditor.getValue() : '';
        const container = document.getElementById('preview-canvas');

        if (currentP5Instance) {
            currentP5Instance.remove();
            currentP5Instance = null;
        }
        container.innerHTML = '';

        const canvasW = step.canvasSize?.w || 200;
        const canvasH = step.canvasSize?.h || 200;

        try {
            currentP5Instance = new p5((p) => {
                // Make all p5 functions available
                const sketch = new Function('p', `
                    with(p) {
                        ${code}
                    }
                `);

                p.setup = function() {
                    p.createCanvas(canvasW, canvasH);
                    if (!code.includes('function setup') && !code.includes('function draw')) {
                        p.background(100, 155, 255);
                        p.noStroke();
                        try { sketch(p); } catch(e) {}
                        p.noLoop();
                    }
                };

                if (code.includes('function draw')) {
                    p.draw = function() {
                        try { sketch(p); } catch(e) {}
                    };
                }
            }, container);
        } catch (e) {
            container.innerHTML = '<p style="color: #ef4444; padding: 20px;">ì½”ë“œ ì˜¤ë¥˜!</p>';
        }
    }

    // ==========================================
    // PRACTICE CHECK
    // ==========================================
    function checkPractice() {
        const step = currentDay.steps[currentStep];
        const code = codeEditor ? codeEditor.getValue() : '';
        const result = document.getElementById('practice-result');
        const wrapper = document.getElementById('practice-editor-wrapper');

        let isCorrect = false;
        if (step.answerCheck) {
            isCorrect = step.answerCheck(code);
        } else {
            const normalize = (s) => s.replace(/\s+/g, '').replace(/;/g, '').toLowerCase();
            isCorrect = code.includes(step.answer) || normalize(code).includes(normalize(step.answer));
        }

        if (isCorrect) {
            playSound('success');
            wrapper.classList.remove('wrong');
            wrapper.classList.add('correct');
            result.className = 'code-result success';
            result.textContent = 'âœ… ì •ë‹µ!';

            document.getElementById('practice-btns').innerHTML = `
                <button class="btn btn-retry" onclick="retryPractice()">ğŸ”„ ë‹¤ì‹œ</button>
                <button class="btn btn-primary" onclick="nextStep()">ë‹¤ìŒ â†’</button>
            `;
        } else {
            wrongAttempts++;
            wrapper.classList.add('wrong');
            result.className = 'code-result error';

            if (wrongAttempts >= 2) {
                result.innerHTML = 'âŒ ë‹¤ì‹œ í•´ë³´ì„¸ìš”! <button onclick="showAnswer()" style="background:#6366f1;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;margin-left:10px;">ğŸ’¡ ì •ë‹µ ë³´ê¸°</button>';
            } else {
                result.textContent = 'âŒ ë‹¤ì‹œ í•´ë³´ì„¸ìš”!';
            }
        }
    }

    function checkBuild() {
        const step = currentDay.steps[currentStep];
        const code = codeEditor ? codeEditor.getValue() : '';
        const result = document.getElementById('build-result');

        let isCorrect = step.answerCheck ? step.answerCheck(code) : code.includes(step.targetCode);

        if (isCorrect) {
            playSound('success');
            result.className = 'code-result success';
            result.textContent = 'âœ… ì™„ì„±!';

            document.getElementById('build-btns').innerHTML = `
                <button class="btn btn-retry" onclick="location.reload()">ğŸ”„ ë‹¤ì‹œ</button>
                <button class="btn btn-primary" onclick="nextStep()">ë‹¤ìŒ â†’</button>
            `;
        } else {
            wrongAttempts++;
            result.className = 'code-result error';

            if (wrongAttempts >= 3) {
                result.innerHTML = 'âŒ íŒíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”! <button onclick="showBuildAnswer()" style="background:#6366f1;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;margin-left:10px;">ğŸ’¡ ì •ë‹µ ë³´ê¸°</button>';
            } else {
                result.textContent = 'âŒ ë‹¤ì‹œ í•´ë³´ì„¸ìš”!';
            }
        }
    }

    function showAnswer() {
        const step = currentDay.steps[currentStep];
        if (codeEditor && step.answer) {
            const currentCode = codeEditor.getValue();
            codeEditor.setValue(currentCode + '\n\n// ì •ë‹µ:\n// ' + step.answer);
        }
        document.getElementById('practice-result').innerHTML = 'ğŸ“ ì •ë‹µì„ í™•ì¸í•˜ì„¸ìš”!';
        document.getElementById('practice-btns').innerHTML = `
            <button class="btn btn-retry" onclick="retryPractice()">ğŸ”„ ë‹¤ì‹œ</button>
            <button class="btn btn-primary" onclick="nextStep()">ë‹¤ìŒ â†’</button>
        `;
    }

    function showBuildAnswer() {
        const step = currentDay.steps[currentStep];
        if (step.targetCode) {
            document.getElementById('build-result').innerHTML = `ğŸ“ ì¶”ê°€í•´ì•¼ í•  ì½”ë“œ: <code style="background:#0d1117;padding:5px 10px;border-radius:5px;">${escapeHtml(step.targetCode)}</code>`;
        }
        document.getElementById('build-btns').innerHTML = `
            <button class="btn btn-retry" onclick="location.reload()">ğŸ”„ ë‹¤ì‹œ</button>
            <button class="btn btn-primary" onclick="nextStep()">ë‹¤ìŒ â†’</button>
        `;
    }

    function retryPractice() {
        const step = currentDay.steps[currentStep];
        if (codeEditor) {
            codeEditor.setValue(step.starterCode || '');
        }
        document.getElementById('practice-result').textContent = '';
        document.getElementById('practice-editor-wrapper').classList.remove('correct', 'wrong');
        document.getElementById('practice-btns').innerHTML = `
            <button class="btn btn-check" onclick="checkPractice()">í™•ì¸í•˜ê¸° âœ“</button>
        `;
        wrongAttempts = 0;
    }

    // ==========================================
    // QUIZ
    // ==========================================
    function selectQuiz(idx) {
        if (quizAnswered) return;

        const step = currentDay.steps[currentStep];
        const options = document.querySelectorAll('.quiz-option');
        quizAnswered = true;

        options.forEach((opt, i) => {
            opt.onclick = null;
            if (i === step.correct) opt.classList.add('correct');
            else if (i === idx) opt.classList.add('wrong');
        });

        const isCorrect = idx === step.correct;
        if (isCorrect) playSound('success');

        const explanationDiv = document.getElementById('quiz-explanation');
        if (explanationDiv && step.explanation) {
            explanationDiv.innerHTML = `
                <div class="highlight-box ${isCorrect ? 'success' : ''}">
                    <strong>${isCorrect ? 'âœ… ì •ë‹µ!' : 'âŒ ì˜¤ë‹µ!'}</strong><br>
                    ${step.explanation}
                </div>
            `;
            explanationDiv.style.display = 'block';
        }

        document.getElementById('next-btn').disabled = false;
    }

    // ==========================================
    // NAVIGATION
    // ==========================================
    function nextStep() {
        currentStep++;
        state.dayProgress[currentDay.day] = currentStep;
        saveState();

        if (currentStep >= currentDay.steps.length) {
            completeDay();
        } else {
            renderProgress();
            renderStep();
            window.scrollTo(0, 0);
        }
    }

    function completeDay() {
        if (!state.completedDays.includes(currentDay.day)) {
            state.completedDays.push(currentDay.day);
            state.xp += currentDay.xp;
            saveState();
            updateStats();
        }
        showReward(currentDay.xp, currentDay.icon);
    }

    // ==========================================
    // REWARD
    // ==========================================
    function showReward(xp, emoji) {
        playSound('success');
        document.getElementById('reward-emoji').textContent = emoji;
        document.getElementById('reward-xp').textContent = `+${xp} XP`;
        document.getElementById('reward-overlay').classList.add('active');
        createConfetti();
    }

    function closeReward() {
        document.getElementById('reward-overlay').classList.remove('active');
        goHome();
    }

    function createConfetti() {
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const pieces = [];
        const colors = ['#6366f1', '#f472b6', '#fbbf24', '#10b981'];

        for (let i = 0; i < 100; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: -20,
                size: Math.random() * 8 + 4,
                color: colors[Math.floor(Math.random() * colors.length)],
                speed: Math.random() * 3 + 2,
                angle: Math.random() * Math.PI * 2
            });
        }

        let frame = 0;
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            pieces.forEach(p => {
                p.y += p.speed;
                p.angle += 0.1;
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.angle);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                ctx.restore();
            });
            frame++;
            if (frame < 150) requestAnimationFrame(animate);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        animate();
    }

    // ==========================================
    // SAVE/LOAD
    // ==========================================
    function exportProgress() {
        const data = JSON.stringify(state, null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `game_backup_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);

        const msg = document.getElementById('save-msg');
        msg.textContent = 'âœ… ë°±ì—… ì™„ë£Œ!';
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 3000);
    }

    function importProgress(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                state = { ...state, ...JSON.parse(e.target.result) };
                saveState();
                updateStats();
                renderHome();
                const msg = document.getElementById('save-msg');
                msg.textContent = 'âœ… ë³µì› ì™„ë£Œ!';
                msg.classList.add('show');
                setTimeout(() => msg.classList.remove('show'), 3000);
            } catch (err) {
                alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ì–´ìš”');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
